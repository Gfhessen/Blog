{{- $pctx := . -}}
{{- if .IsHome -}}{{ $pctx = .Site }}{{- end -}}
{{- $pages := slice -}}
{{- if or $.IsHome $.IsSection -}}
{{- $pages = $pctx.RegularPages -}}
{{- else -}}
{{- $pages = $pctx.Pages -}}
{{- end -}}
{{- $limit := .Site.Config.Services.RSS.Limit -}}
{{- if ge $limit 1 -}}
{{- $pages = $pages | first $limit -}}
{{- end -}}
{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\"?>" | safeHTML }}
<feed xmlns="http://www.w3.org/2005/Atom">
  {{ with .OutputFormats.Get "RSS" }}
  <id>{{ .Permalink }}</id>
  <link href="{{ .Permalink }}" rel="self"/>
  {{ end }}

  <title>{{ if eq  .Title  .Site.Title }}{{ .Site.Title }}{{ else }}{{ with .Title }}{{.}} on {{ end }}{{ .Site.Title }}{{ end }}</title>
	<subtitle>Recent blog posts</subtitle>
  <author>
    {{ with .Site.Author.name }}
    <name>{{ . }}</name>
    {{ end }}

    {{ with .Site.Author.email }}
    <email>{{ . }}</email>
    {{ end }}

    <uri>{{ .Permalink }}</uri>
  </author>
	<updated>{{ .Date.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}</updated>
	
  {{ range $pages }}
	<entry>
    <id>{{ .Permalink }}</id>
    <title>{{ .Title }}</title>
    <link href="{{ .Permalink }}" />
		<updated>{{ .Date.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}</updated>
    <summary>{{ .Params.description }}</summary>
    <content type="html">{{ .Content | html }}</content>


    {{ range .Params.tags }}
    <category term="{{ . }}"/>
    {{ end }}
	</entry>
  {{ end }}
</feed>
